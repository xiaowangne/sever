/* empty css                  *//* empty css                      *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  */import{t as e}from"./tool.8164259c.js";import"./el-form-item.c6f666bf.js";import{f as a,x as t,w as s,g as l,h as o,j as r,a3 as d,J as u,A as i,y as n,z as p,a4 as c,a5 as m,B as f,a6 as g,a7 as h,o as y,m as v,n as b,D as k,F as w,I as C,a8 as _,G as I,ac as z,H as A,t as j,c as x}from"./vendor.555231f0.js";const V={class:"type-list"},S={class:"seach-section"},L={class:"create-type"},$=A("添加文章"),D=A("删除选择"),M=A("查询"),U={class:"type-list-table"},E=["src"],q=A("编辑 "),B=A("启用 "),F=A("冻结 "),G=A("删除 "),H={class:"pagination-box"};var J=a({name:"ArticleList",setup(a){const J=t(),{proxy:N}=s(),R=N.$serverUrl;l([]);const T=o({title:"",typeId:"-1",status:"-1"}),K=l({}),O=o({total:0,pagerCount:5,pageSize:10,pageArray:[2,5,10,20,30,50,100,200],offset:0}),P=l([]),Q=e=>{O.offset=0,O.pageSize=e,ae()},W=e=>{O.offset=(e-1)*O.pageSize,ae()},X=l([]),Y=l([]);r((()=>{ee(),se()}));const Z=d((()=>P.value.length>0)),ee=()=>{O.total=0,O.offset=0,K.value=T,te(),ae()},ae=()=>{let a={offset:O.offset,count:O.pageSize};for(let e in T)("status"!=e&&"typeId"!=e||"-1"!=T[e])&&T[e]&&(a[e]=T[e]);N.$axios.get("/articleList",{params:a,headers:{token:document.cookie}}).then((a=>{if(1041==a.data.status)return J.push({name:"Login"});1160==a.data.status&&(a.data.data.forEach((a=>{a.createdAt=e.formatDate(a.createdAt,"yyyy-MM-dd hh:mm:ss"),a.updatedAt=e.formatDate(a.updatedAt,"yyyy-MM-dd hh:mm:ss")})),X.value=a.data.data,te())})).catch((e=>{console.log("error",e)}))},te=()=>{let e={};for(let a in K.value)("status"!=a&&"typeId"!=a||"-1"!=K.value[a])&&K.value[a]&&(e[a]=K.value[a]);N.$axios.get("/articleCount",{params:e,headers:{token:document.cookie}}).then((e=>{if(1041==e.data.status)return J.push({name:"Login"});1170==e.data.status&&(O.total=e.data.data[0].count)})).catch((e=>{console.log("error",e)}))},se=()=>{N.$axios({method:"get",url:"/typeData",headers:{token:document.cookie}}).then((e=>{if(1041==e.data.status)return u({showClose:!0,message:e.data.msg,type:"error"}),J.push({name:"Login"});1140==e.data.status?Y.value=e.data.data:u({showClose:!0,message:e.data.msg,type:"error"})})).catch((e=>{console.log("error",e)}))},le=e=>{N.$axios({method:"post",url:"/articleStatus",data:{typeId:e.typeId,artId:e.artId,status:0==e.status?1:0,type:"Article"},headers:{token:document.cookie}}).then((a=>{if(1041==a.data.status)return J.push({name:"Login"});1180==a.data.status&&1==a.data.data.result[0]?(u({message:a.data.msg,showClose:!0,type:"success"}),e.status=a.data.data.status):u({message:a.data.msg,type:"error",showClose:!0})})).catch((e=>{console.log("err ==> ",e)}))},oe=e=>{P.value=[],e.forEach((e=>{P.value.push(e.artId)}))},re=e=>{N.$axios({method:"post",url:"/removeArticle",data:{artIds:e},headers:{token:document.cookie}}).then((e=>{if(1041==e.data.status)return J.push({name:"Login"});1210==e.data.status?(u({message:e.data.msg,showClose:!0,type:"success"}),X.value=[],ee()):u({message:e.data.msg,type:"error",showClose:!0})})).catch((e=>{console.log("err ==> ",e)}))},de=()=>{re(P.value)},ue=()=>{J.push({name:"AddArticle"})};return(e,a)=>{const t=i,s=n,l=p,o=c,r=m,d=f,u=g,N=h;return y(),v("div",V,[b("div",S,[b("div",L,[k(t,{type:"primary",onClick:ue},{default:w((()=>[$])),_:1}),k(t,{type:"danger",disabled:!C(Z),onClick:de},{default:w((()=>[D])),_:1},8,["disabled"])]),k(d,{inline:!0,model:T,class:"demo-form-inline"},{default:w((()=>[k(l,{label:"文章名称"},{default:w((()=>[k(s,{modelValue:T.title,"onUpdate:modelValue":a[0]||(a[0]=e=>T.title=e),placeholder:"输入文章名称"},null,8,["modelValue"])])),_:1}),k(l,{label:"文章类型"},{default:w((()=>[k(r,{modelValue:T.typeId,"onUpdate:modelValue":a[1]||(a[1]=e=>T.typeId=e),placeholder:"选择文章类型"},{default:w((()=>[k(o,{label:"选择文章类型",value:"-1"}),(y(!0),v(I,null,z(Y.value,(e=>(y(),x(o,{label:e.title,value:e.typeId,key:e.typeId},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),k(l,{label:"状态"},{default:w((()=>[k(r,{modelValue:T.status,"onUpdate:modelValue":a[2]||(a[2]=e=>T.status=e),placeholder:"选择状态"},{default:w((()=>[k(o,{label:"选择状态",value:"-1"}),k(o,{label:"正常",value:"0"}),k(o,{label:"冻结",value:"1"})])),_:1},8,["modelValue"])])),_:1}),k(l,null,{default:w((()=>[k(t,{type:"primary",onClick:ae},{default:w((()=>[M])),_:1})])),_:1})])),_:1},8,["model"])]),b("div",U,[k(C(_),{ref:"multipleTableRef",data:X.value,onSelectionChange:oe},{default:w((()=>[k(u,{type:"selection",width:"55"}),k(u,{prop:"typeName",label:"文章类型",width:"120"}),k(u,{property:"title",label:"名称",width:"120"}),k(u,{property:"status",label:"状态",width:"120","show-overflow-tooltip":""},{default:w((e=>[A(j(0==e.row.status?"正常":"冻结"),1)])),_:1}),k(u,{label:"更新时间",width:"180"},{default:w((e=>[A(j(e.row.createdAt),1)])),_:1}),k(u,{label:"图片",width:"180"},{default:w((e=>[b("img",{src:""==e.row.img?"/src/assets/images/nopic.png":C(R)+"/"+e.row.img},null,8,E)])),_:1}),k(u,{label:"操作"},{default:w((e=>[k(t,{size:"small",type:"default",plain:"",onClick:a=>{return t=e.row.artId,void J.push({name:"AddArticle",query:{artId:t}});var t}},{default:w((()=>[q])),_:2},1032,["onClick"]),1==e.row.status?(y(),x(t,{key:0,size:"small",type:"success",plain:"",onClick:a=>le(e.row)},{default:w((()=>[B])),_:2},1032,["onClick"])):(y(),x(t,{key:1,size:"small",type:"warning",plain:"",onClick:a=>le(e.row)},{default:w((()=>[F])),_:2},1032,["onClick"])),k(t,{size:"small",type:"danger",plain:"",onClick:a=>{return t=e.row.artId,void re([t]);var t}},{default:w((()=>[G])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),b("div",H,[k(N,{background:"","pager-count":O.pagerCount,"page-size":O.pageSize,"page-sizes":O.pageArray,layout:"total, sizes, prev, pager, next, jumper",total:O.total,onSizeChange:Q,onCurrentChange:W},null,8,["pager-count","page-size","page-sizes","total"])])])])}}});export{J as default};

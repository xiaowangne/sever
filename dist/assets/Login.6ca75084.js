/* empty css                  *//* empty css                 */import"./el-form-item.c6f666bf.js";import{f as e,g as a,j as l,o,m as r,w as t,x as s,h as d,y as u,z as n,A as i,B as v,D as p,F as f,K as m,n as c,H as h,J as w,L as g}from"./vendor.555231f0.js";var C=e({name:"ValidateCode",emits:["onReceiveCode"],setup(e,{expose:t,emit:s}){const d=a([]),u=a(""),n=a(""),i=a(["red","brown","blue","green","pink","black"]),v=a(4),p=a();l((()=>{f()}));const f=()=>{(()=>{d.value=[];const e="abcdefghijkmnpqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ23456789".split("");for(let a=0;a<v.value;a++){const a=Math.floor(Math.random()*e.length);d.value.push(e[a])}})(),m(),s("onReceiveCode",u.value)};t({draw:f});const m=()=>{n.value=p.value.getContext("2d"),n.value.fillStyle="#f3fbfe",n.value.fillRect(0,0,140,40),n.value.font="20px Verdana";let e=15;for(let a=0;a<v.value;a++)n.value.fillStyle=i.value[Math.floor(5*Math.random())],n.value.fillText(d.value[a],e,25),e+=30;(()=>{for(let e=0;e<2;e++)n.value.strokeStyle=i.value[Math.floor(5*Math.random())],n.value.beginPath(),n.value.moveTo(Math.floor(140*Math.random()),Math.floor(30*Math.random())),n.value.lineTo(Math.floor(140*Math.random()),Math.floor(30*Math.random())),n.value.stroke()})(),(()=>{u.value="";for(let e=0;e<d.value.length;e++)u.value+=d.value[e];u.value=u.value.toUpperCase()})()};return(e,a)=>(o(),r("canvas",{ref_key:"canvas",ref:p,onClick:f,width:"140",height:"40",style:{cursor:"pointer"}},null,512))}});const y={class:"login-container",id:"login"},M=c("h3",{class:"login_title"},"后台管理系统--登录",-1),b={class:"code"},k=h("登录"),V={class:"p"},_=h("尚未注册，");var x=e({name:"Login",setup(e){const{proxy:l}=t(),h=a(),x=s(),E=d({password:"",email:"",validCode:""}),R=a(""),j=e=>{R.value=e},U=a(),S=d({password:[{validator:(e,a,l)=>{if(""===a)l(new Error("密码不能为空"));else{/^[A-Za-z]\w{5,15}$/.test(a)?l():l(new Error("密码支持字母数字下划线且首字母必须为字母(6~16位)"))}},trigger:"blur"}],email:[{validator:(e,a,l)=>{if(""===a)l(new Error("邮箱不能为空"));else{/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test(a)?l():l(new Error("邮箱格式不正确"))}},trigger:"blur"}],validCode:[{validator:(e,a,l)=>{if(""===a)l(new Error("验证码不能为空"));else{/^[[A-Za-z0-9]{4}$/.test(a)?l():l(new Error("验证码不正确"))}},trigger:"blur"}]}),$=e=>{e&&e.validate((e=>{if(e){if(E.validCode.toUpperCase()!=R.value)return w({showClose:!0,message:"验证码不正确",type:"error"}),U.value.draw(),void(E.validCode="");l.$axios.post("/login",{email:E.email,password:E.password}).then((e=>{if(1e3===e.data.status){for(let a in e.data.data)l.$cookies.set(a,e.data.data[a],"1d");w({showClose:!0,message:e.data.msg,type:"success"}),x.push({name:"System"})}else w({showClose:!0,message:e.data.msg,type:"error"}),U.value.draw(),E.validCode=""})).catch((e=>{console.log("error",e),U.value.draw(),E.validCode=""}))}}))};return(e,a)=>{const l=u,t=n,s=i,d=v;return o(),r("div",y,[p(d,{class:"login-form",ref_key:"ruleFormRef",ref:h,model:E,"status-icon":"",rules:S},{default:f((()=>[M,p(t,{prop:"email"},{default:f((()=>[p(l,{placeholder:"邮箱",modelValue:E.email,"onUpdate:modelValue":a[0]||(a[0]=e=>E.email=e)},null,8,["modelValue"])])),_:1}),p(t,{prop:"password"},{default:f((()=>[p(l,{type:"password",autocomplete:"off",placeholder:"密码",modelValue:E.password,"onUpdate:modelValue":a[1]||(a[1]=e=>E.password=e)},null,8,["modelValue"])])),_:1}),p(t,{prop:"validCode",class:"validCode"},{default:f((()=>[p(l,{placeholder:"验证码",modelValue:E.validCode,"onUpdate:modelValue":a[2]||(a[2]=e=>E.validCode=e),maxlength:4,onKeyup:a[3]||(a[3]=m(g((e=>$(h.value)),["prevent"]),["enter"]))},null,8,["modelValue"]),c("div",b,[p(C,{onOnReceiveCode:j,ref_key:"draw",ref:U},null,512)])])),_:1}),p(t,{class:"submit"},{default:f((()=>[p(s,{type:"primary",onClick:a[4]||(a[4]=e=>$(h.value))},{default:f((()=>[k])),_:1})])),_:1}),p(t,{class:"res"},{default:f((()=>[c("div",V,[_,c("span",{onClick:a[5]||(a[5]=e=>{x.push({name:"Register"})})},"去注册>>")])])),_:1})])),_:1},8,["model","rules"])])}}});export{x as default};

/* empty css                  *//* empty css                 */import{_ as e}from"./Back.vue_vue&type=style&index=0&lang.1aea6dd8.js";/* empty css                   *//* empty css                    *//* empty css                *//* empty css               *//* empty css                  *//* empty css                  */import"./el-form-item.c6f666bf.js";import{f as a,w as t,x as l,g as s,h as o,j as r,J as u,y as d,z as i,a4 as n,a5 as p,r as m,T as c,a1 as f,C as g,a9 as h,aa as y,A as v,B as b,o as _,m as V,D as w,n as L,F as j,G as I,ac as C,H as k,t as x,c as B}from"./vendor.555231f0.js";const U={class:"create-type-section"},N={class:"create-type-form"},$=["src"],D=k("正常"),J=k("冻结");var S=a({name:"AddBanner",setup(a){const{proxy:S}=t(),q=l(),z=s(""),F=s(!1),O=S.$serverUrl,T=s("default"),A=s(),M=s([]),R=o({title:"",typeId:"",typeName:"",fileList:[],description:"",status:"0",url:""}),E=s({});s([]);const G=s();r((()=>{let e=q.currentRoute.value.query.banId;e&&(G.value=e,Y()),X()}));const H=o({title:[{required:!0,message:"请输入标题",trigger:"blur"}],typeId:[{required:!0,message:"请选择分类",trigger:"change"}]}),P=e=>{for(let a=0;a<M.value.length;a++)if(e==M.value[a].typeId)return void(R.typeName=M.value[a].title)},K=e=>{z.value=e.url,F.value=!0},Q=e=>{const a=new FormData;for(let t in e)"fileList"==t?(e.fileList.forEach((e=>{a.append("file",e.raw)})),0===e.fileList.length&&a.append("file","")):a.append(t,e[t]);return a};let W={headers:{token:document.cookie,"Content-Type":"multipart/form-data"}};const X=()=>{S.$axios.get("/bannerType",{headers:{token:document.cookie}}).then((e=>{if(1041==e.data.status)return q.push({name:"Login"});1230==e.data.status&&(M.value=e.data.data)})).catch((e=>{console.log("error",e)}))},Y=()=>{S.$axios.get("/bannerDataByBanId",{params:{banId:G.value},headers:{token:document.cookie}}).then((e=>{if(1041==e.data.status)return u({showClose:!0,message:e.data.msg,type:"error"}),q.push({name:"Login"});if(1310==e.data.status){u({showClose:!0,message:e.data.msg,type:"success"});let a=e.data.data[0];if(R.title=a.title,""!=a.imgMore){let e=a.imgMore.split(",");for(let a=0;a<e.length;a++)R.fileList.push({url:O+"/"+e[a]})}R.description=a.description,R.status=Number(a.status).toString(),R.url=a.url,R.typeId=a.typeId,E.value=JSON.parse(JSON.stringify(R))}else u({showClose:!0,message:e.data.msg,type:"error"})})).catch((e=>{console.log("error",e)}))};let Z={};const ee=async e=>{if(!e)return;let a=Q(R);await e.validate(((e,t)=>{var l,s;e?G.value?(e=>{for(let t in R)if("fileList"===t)if(R[t].length==E.value[t].length)for(let e=0;e<R[t].length;e++)E.value[t][e].url!=R[t][e].url&&(Z[t]=R[t]);else Z[t]=R[t];else E.value[t]!=R[t]&&(Z[t]=R[t]);if("{}"==JSON.stringify(Z))return q.push({name:"BannerList"});Z.banId=G.value;let a=Q(Z);S.$axios.post("/editBanner",a,e).then((e=>1041==e.data.status?(u({showClose:!0,message:e.data.msg,type:"error"}),q.push({name:"Login"})):1320==e.data.status?(u({showClose:!0,message:e.data.msg,type:"success"}),q.push({name:"BannerList"})):void u({showClose:!0,message:e.data.msg,type:"error"}))).catch((e=>{console.log("error",e)}))})(W):(l=a,s=W,S.$axios.post("/createBanner",l,s).then((e=>1041==e.data.status?(u({showClose:!0,message:e.data.msg,type:"error"}),q.push({name:"Login"})):1270==e.data.status?(u({showClose:!0,message:e.data.msg,type:"success"}),q.push({name:"BannerList"})):void u({showClose:!0,message:e.data.msg,type:"error"}))).catch((e=>{console.log("error",e)}))):console.log("error submit!",t)}))};return(a,t)=>{const l=d,s=i,o=n,r=p,u=m("Plus"),S=c,q=f,O=g,E=h,Q=y,W=v,X=b;return _(),V("div",U,[w(e,{title:"添加轮播图"}),L("div",N,[w(X,{ref_key:"typeDataRef",ref:A,model:R,rules:H,"label-width":"120px",class:"demo-ruleForm",size:T.value,"status-icon":""},{default:j((()=>[w(s,{label:"标题",prop:"title"},{default:j((()=>[w(l,{modelValue:R.title,"onUpdate:modelValue":t[0]||(t[0]=e=>R.title=e),placeholder:"输入标题"},null,8,["modelValue"])])),_:1}),w(s,{label:"类型",prop:"typeId"},{default:j((()=>[w(r,{modelValue:R.typeId,"onUpdate:modelValue":t[1]||(t[1]=e=>R.typeId=e),clearable:"",placeholder:"选择分类",onChange:P},{default:j((()=>[(_(!0),V(I,null,C(M.value,(e=>(_(),B(o,{label:e.title,value:e.typeId,key:e.typeId},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),w(s,{label:"图片"},{default:j((()=>[w(q,{"list-type":"picture-card","auto-upload":!1,limit:1,"file-list":R.fileList,"onUpdate:file-list":t[2]||(t[2]=e=>R.fileList=e),accept:".png,.jpg,.jpeg,.webp","on-preview":K},{default:j((()=>[w(S,{color:"#999999"},{default:j((()=>[w(u)])),_:1})])),_:1},8,["file-list"]),w(O,{modelValue:F.value,"onUpdate:modelValue":t[3]||(t[3]=e=>F.value=e)},{default:j((()=>[L("img",{"w-full":"",src:z.value,alt:"图片预览"},null,8,$)])),_:1},8,["modelValue"])])),_:1}),w(s,{label:"描述"},{default:j((()=>[w(l,{modelValue:R.description,"onUpdate:modelValue":t[4]||(t[4]=e=>R.description=e),type:"textarea"},null,8,["modelValue"])])),_:1}),w(s,{label:"链接"},{default:j((()=>[w(l,{modelValue:R.url,"onUpdate:modelValue":t[5]||(t[5]=e=>R.url=e),placeholder:"输入链接地址"},null,8,["modelValue"])])),_:1}),w(s,{label:"状态"},{default:j((()=>[w(Q,{modelValue:R.status,"onUpdate:modelValue":t[6]||(t[6]=e=>R.status=e)},{default:j((()=>[w(E,{label:"0"},{default:j((()=>[D])),_:1}),w(E,{label:"1"},{default:j((()=>[J])),_:1})])),_:1},8,["modelValue"])])),_:1}),w(s,null,{default:j((()=>[w(W,{type:"primary",onClick:t[7]||(t[7]=e=>ee(A.value))},{default:j((()=>[k(x(G.value?"保存":"创建"),1)])),_:1})])),_:1})])),_:1},8,["model","rules","size"])])])}}});export{S as default};
